{"ts":1365391160650,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var cssom = require('cssom');\nvar cheerio = require('cheerio');\n\nmodule.export = function (sel,html,css){\n    var classes = []\n    //load and parse html\n    var $ = cheerio.load(html);\n    var all = $(sel).find(\"*\");\n    \n    //get classes from html:  atributes -> css -> flatten the arrays\n    classes = [].concat.apply([],[].map.call(all,getAtribs).map(getClassesFromHtml));\n    //console.log(classes) \n    \n    //Get CSS styles from css: parse rules->filter selectors ->parseToString \n    var usedSelectors = cssom.parse(css).cssRules.filter(getUsedSelectors).map(parseSelectorsToString).join(\"\");\n    var unUsedSelectors = cssom.parse(css).cssRules.filter(getUnUsedSelectors).map(parseSelectorsToString).join(\"\");\n    //console.log(unUsedSelectors)\n    \n    return {usedCss:usedSelectors,unUsedCss:unUsedSelectors};\n    \n    //Helper functions  for HTML parsing\n    function getAtribs(item){\n        return item.attribs\n    }\n    \n    function getClassesFromHtml(item){\n         if (item.class !== undefined) return item.class.split(\" \");\n    }\n    \n    //Helper functions for CSS parsing\n    function getUsedSelectors(item){\n          return classes.some(function(r){\n                return r === item.selectorText;\n        });\n    }\n    function getUnUsedSelectors(item){\n          return classes.every(function(r){\n                return r !== item.selectorText;\n        });\n    }    \n    function parseSelectorsToString(item){\n        var css = \"\";\n        var len = item.style.length;\n        for (var i =0; i<len; i ++){\n            css += \"\\t\" + item.style[i] + \":\" + item.style[item.style[i]] + \";\\n\" \n        }\n        return item.selectorText + \"{\\n\" + css +\"}\\n\\n\" \n    }\n}"]],"start1":0,"start2":0,"length1":0,"length2":1688}]],"length":1688}
{"contributors":[],"silentsave":false,"ts":1365391494566,"patch":[[{"diffs":[[0,"e.export"],[1,"s"],[0," = funct"]],"start1":70,"start2":70,"length1":16,"length2":17}]],"length":1689,"saved":false}
